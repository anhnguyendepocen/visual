---
title: Chapter 10 Dynamic Networks
output: html_document
---

#10.1 Introduction
??? ????????? ?????? ??????????????? ?????? ??????????
????????????!

#10.2 ?????? ??????????????? ????????? ??????

??????????????? ?????? ??????????????? ???????????????. 
??????????????? ?????? ???????????? ????????????  time-indexed graph G(t) = (V(t),E(t)) ??? ???????????????. 
t: ??????
E(t), the set values ei j(t), for i, j ???V(t)
V(t) ??? V for all t.

???????????? ?????? ?????? ??? ?????? ????????? ????????? ?????? ????????????, 
???????????? ?????? ?????? -> ?????? -> ???????????? ????????? ??????????????? ????????? ??????
????????? ???????????? ????????? ?????????, ?????? ?????? ?????? ???????????????.  
??? ????????? ????????? ????????? ??????????????? Law of Mass Action??? ????????????. 

https://lsy5518.files.wordpress.com/2014/09/sirimage.png

?????? ??????
https://lsy5518.wordpress.com/2014/09/28/sir-%EB%AA%A8%EB%8D%B8-sir-model/

```{r}
#install.packages("sand")
#library(sand)
#install_sand_packages()
```

data(hc)??????
Vanhems ?????? ??????
2010 ??? ?????? 1????????? 12 ??? 6 ??? ?????? 2??? ????????? ?????? ????????? ????????? ?????? ???????????? ????????? ????????? ??????
(75????????? ????????? ?????? 20??? ?????? ????????? 1.5 m????????? ????????? ???????????? ?????? RFID sensors??? ??????)



```{r}
library(sand)
data(hc)
```


```{r}
head(hc)
```

??? ???????????? ????????? ?????????  
administrative staff (ADM)
medical doctor (MED)
nurses or nurses??? aides (NUR)
patients (PAT).


```{r}
ID.stack <- c(hc$ID1,hc$ID2)
Status.stack <- c(as.character(hc$S1),
as.character(hc$S2))
my.t <- table(ID.stack,Status.stack)
v.status <- character(nrow(my.t))
for(i in (1:length(v.status))){
v.status[i] <- names(which(my.t[i,]!=0))
}
table(v.status)
```

ADM 12???, MED 8??? NUR 27??? PAT 29????????????
?????? ???????????? ????????? ?????? 40% ?????? ???????????? ????????? ?????? 10% ?????? ??????. 

```{r}
status.t <- table(hc$S1, hc$S2)
status.t <- status.t + t(status.t)
diag(status.t) <- round(diag(status.t)/2)
status.t
```

 ????????? ???????????? ?????? ???????????? ?????? ??????! 
 ?????? ?????? ?????? ?????????????????? ????????? 12695?????? ?????? ?????? ?????? ??????????????? ????????? 209???.
 ????????? ?????????????????? ????????????!

```{r}
tmp.es <- paste(hc$S1, "-", hc$S2, sep="")
e.status <- character(dim(hc)[[1]])
e.status[tmp.es=="ADM-ADM"] <- "ADM-ADM"
e.status[tmp.es=="MED-MED"] <- "MED-MED"
e.status[tmp.es=="NUR-NUR"] <- "NUR-NUR"
e.status[tmp.es=="PAT-PAT"] <- "PAT-PAT"
e.status[(tmp.es=="ADM-MED") |
(tmp.es=="MED-ADM")] <- "ADM-MED"
e.status[(tmp.es=="ADM-NUR") |
(tmp.es=="NUR-ADM")] <- "ADM-NUR"
e.status[(tmp.es=="ADM-PAT") |
(tmp.es=="PAT-ADM")] <- "ADM-PAT"
e.status[(tmp.es=="MED-NUR") |
(tmp.es=="NUR-MED")] <- "MED-NUR"
e.status[(tmp.es=="MED-PAT") |
(tmp.es=="PAT-MED")] <- "MED-PAT"
e.status[(tmp.es=="NUR-PAT") |
(tmp.es=="PAT-NUR")] <- "NUR-PAT"
my.hc <- data.frame(Time = hc$Time/(60*60),
ID1 = hc$ID1,
ID2 = hc$ID2,
Status = e.status)

library(lattice)
histogram( ~ Time|Status, data=my.hc, xlab="Hours",
layout=c(5,2))
```
????????? ????????? ??????????????? ?????? ????????? ????????????. 
igraph??? ????????? ??? ????????? ????????????. 

```{r}
#install.packages("igraph")
#library(igraph)
```                
 igraph?????? ????????? ??????????????? ????????????

????????? ????????? ????????? ???????????? ?????? ???????????? ??????
?????? ???????????? ????????? ??????(multiple edges) ?????? ?????? ??????( parallel edges)??? ???????????? ????????????


time interval ??? ???????????? ??? ??????
```{r}                
vids <- sort(unique(c(hc$ID1, hc$ID2)))
g.week <- graph.data.frame(hc[, c("ID1", "ID2",
"Time")], vertices=data.frame(vids),
directed=FALSE)
E(g.week)$Time <- E(g.week)$Time / (60 * 60)
```
??????) ??? ??????????????? ?????? ???????????? 32424?????? ?????? ????????? 75?????? vertex???  ?????? ?????????
?????? ????????? ???????????? ??? ??? ??????

```{r}
g.week
````

vertex?????? incorporate status??? ??? ??? ??????

```{r}
status <- unique(rbind(data.frame(id=hc$ID1,
status=hc$S1), data.frame(id=hc$ID2, status=hc$S2)))
V(g.week)$Status <-
as.character(status[order(status[,1]),2])
```

???????????? ????????? ???????????? ????????? ??? ???????????? ???????????? ??? ??? ?????????
?????? ????????? vertex pairs??? ????????? ????????? ????????? ????????? ???????????? ?????? ????????? ?????? 

```{r}
E(g.week)$weight <- 1
g.week.wgtd <- simplify(g.week)
g.week.wgtd
```

???????????????????~ ????????? ?????????????????? ??? 

```{r}
is.simple(g.week.wgtd)
```

1139?????? ????????? ????????? ?????? ????????? ?????? ??????????????? ??????????????? ??????
????????????  1-20??? ????????? ?????????.

```{r}
summary(E(g.week.wgtd)$weight)

```

?????? ????????? ???????????? ?????? ?????? ????????? ??? ??????
??????????????????
?????? ???????????? "????????????"??? ???????????? ??? ???????????? ????????? ??????????????? ???.
????????? ?????? ?????????????????? ?????? 4???(96??????)??? ????????? ???

```{r}
g.week.96 <- subgraph.edges(g.week,
   E(g.week)[Time <= 96])
```

????????? ??????????????? 12???????????? ?????? ??????

```{r}
g.sl12 <- lapply(1:8, function(i) {
   g <- subgraph.edges(g.week, 
                       E(g.week)[Time > 12*(i-1) & 
                                 Time <= 12*i],
                       delete.vertices=FALSE)
   simplify(g)
 })

```

8?????? ?????? ??????????????? ???????????? ???????????? ??????
??? ???????????? vertices??? ???????????? 75?????? ?????? ????????? ???????????? ????????? ?????????

```{r}
sapply(g.sl12,vcount)
```


????????? ??? ??? ?????? ????????? ???????????? ???????????? 2-3??? ?????? ???????????? ???????????? ?????? ??? ??? ??????

```{r}
sapply(g.sl12,ecount)
```

?????? ?????? ???????????? ???????????? ??????!
G(t)=(V(t),E(t)) 
??? ????????? ????????? ????????? ?????????!

????????? ??????)
??????????????? ????????? 9?????? - ?????? 'on' ???????????? :  ??? ????????? ????????? ????????? ?????? ??? ??????????????? ????????? ????????? ?????? ????????? ????????????. 10???????????? - ?????? 'of' ???????????? : ????????? ????????? ????????? ?????? ????????? ????????????.
?????? ?????????. (????????? ?????? ????????? ??? ?????????)

```{r}
library(networkDynamic)
```

????????? ?????? ????????? 20??? ??????????????? ?????? ????????? ?????? 20??? ?????? ???????????? ???????????? ????????? ??? 
????????? ??????????????? 20??? ???

```{r}
hc.spls <- cbind((hc$Time-20)/(60*60),
                   hc$Time/(60*60),
                   hc$ID1,hc$ID2)
hc.dn <- networkDynamic(edge.spells=hc.spls)
```


Dynamicnetwork ???????????? ????????? query??? ??????????????? ???????????? ?????? ????????????


```{r}
is.active(hc.dn,onset=0,terminus=1,e=c(1))
```

??? ??????(?????? ?????? ?????? ????????? ???????????? ???????????? ????????? ????????? ?????? ??????)
??? ?????? ???????????? ?????? ????????? ????????? ??? ??????.
???) ????????? ????????? 4??? ??? ?????? ???????????? ??????????????????

```{r}
get.edge.activity(hc.dn,e=c(1))
```

??????????????? ?????????  ?????? ?????? ??????) ???????????? ?????? ?????? ????????????  matrix ????????? ????????? ??????
1??? column 2??? column ??? ??? ?????? ????????? ??????. ??? ??? ????????? ????????? ???!

```{r}
get.edge.activity(hc.dn,e=c(10))
```

 networkDynamic ???????????? ???????????? convert ?????? ?????? ??????!
???????????? ?????? ??????. ??? ????????? ????????? ?????? ??????, ??????, ??????
?????? 12 ????????? ????????? ???????????? 8?????? ?????? ??????????????? ??????!!

```{r}
g.sl12.dN <- get.networks(hc.dn,start=0,end=96,
                           time.increment=12)
```


?????? ????????? ?????????????????? ????????? ?????? ????????? ???????????? ???????????? ???
```{r}
hc.dn.df <- as.data.frame(hc.dn)
names(hc.dn.df)
```

???????????? ??? ??? ?????? ?????? ?????? ?????? ?????? ????????? ????????? ??? ????????? ???????????? ??????
(?????? ??????????????? ????????????)

```{r}
summary(hc.dn.df$duration)
```



#10.3 ?????? ???????????? ????????? 

?????? ????????? ?????? ?????? ????????? ???????????? ???????????? ?????? ??? ?????? ?????? ????????? ??????

??????: ????????? 
Vertex colors:??? ?????? 
ADM(??????), MED(??????), NUR(??????), PAT(??????)


```{r}
detach(package:networkDynamic)
l = layout.fruchterman.reingold(g.week.wgtd)
v.cols <- character(75)
v.cols[V(g.week.wgtd)$Status=="ADM"] <- "yellow"
v.cols[V(g.week.wgtd)$Status=="MED"] <- "blue"
v.cols[V(g.week.wgtd)$Status=="NUR"] <- "green"
v.cols[V(g.week.wgtd)$Status=="PAT"] <- "black"
plot(g.week.wgtd, layout=l, vertex.size=3,
    edge.width=2*(E(g.week.wgtd)$weight)/100,
    vertex.color=v.cols,vertex.label=NA,)
```

?????? 12?????? ????????? 8?????? static networks??? ??????????????? ?????? ?????? ????????? ??????!

```{r}
opar <- par()
par(mfrow=c(2,4),
     mar=c(0.5, 0.5, 0.5, 0.5), 
     oma=c(0.5, 1.0, 0.5, 0))
for(i in (1:8)) {
   plot(g.sl12[[i]], layout=l, vertex.size=5,
     edge.width=2*(E(g.week.wgtd)$weight)/1000,
     vertex.color=v.cols,vertex.label=NA)
   title(paste(12*(i-1),"to",12*i,"hrs"))
 }
par(opar)
```

phase-plot??? ??????
hospital contact network?????? 5??? 96 ????????? ?????? ????????? ?????? ????????? ?????? presence/absence??? ????????????
(????????? gray vertical lines?????? ??????)
```{r}
#????????? ?????? ??????

tmp.es <- paste(v.status[hc.dn.df$tail],"-",
                 v.status[hc.dn.df$head],sep="")
mycols <- numeric(nrow(hc.dn.df))
mycols[tmp.es=="ADM-ADM"] <- 1
mycols[tmp.es=="MED-MED"] <- 2
mycols[tmp.es=="NUR-NUR"] <- 3
mycols[tmp.es=="PAT-PAT"] <- 4
mycols[(tmp.es=="ADM-MED") | (tmp.es=="MED-ADM")] <- 5
mycols[(tmp.es=="ADM-NUR") | (tmp.es=="NUR-ADM")] <- 6
mycols[(tmp.es=="ADM-PAT") | (tmp.es=="PAT-ADM")] <- 7
mycols[(tmp.es=="MED-NUR") | (tmp.es=="NUR-MED")] <- 8
mycols[(tmp.es=="MED-PAT") | (tmp.es=="PAT-MED")] <- 9
mycols[(tmp.es=="NUR-PAT") | (tmp.es=="PAT-NUR")] <- 10
my.palette <- rainbow(10)
# Produce plot.
ne <- max(hc.dn.df$edge.id)
max.t <- max(hc.dn.df$terminus)
plot(c(0,max.t),c(0,ne),ann=F,type='n')
segments(hc.dn.df$onset,hc.dn.df$edge.id,
   hc.dn.df$terminus,hc.dn.df$edge.id,
   col=my.palette[mycols])
title(xlab="Time (hours)",
   ylab="Interacting Pair 
   (Ordered by First Interaction)")
abline(v=c(11,35,59,83),lty="dashed",lw=2,
   col="lightgray")
# Add legend to plot.
status.pairs <- c("ADM-ADM","MED-MED","NUR-NUR",
   "PAT-PAT", "ADM-MED","ADM-NUR","ADM-PAT",
    "MED-NUR", "MED-PAT","NUR-PAT")
legend(7,1170,status.pairs,
        text.col=my.palette[(1:10)],cex=0.75)


```


#10.4 ?????? ??????????????? ??????

????????? ???????????? ?????? ????????? ????????? ??? ??? ??? ????????? ?????? ?????? ????????????. 
```{r}
all.deg <- sapply(g.sl12,degree)
sl.lab<- unlist(lapply(1:8, function(i) 
   paste(12*(i-1), "-", 12*i, "hrs", sep="")))
deg.df <- data.frame(Degree=as.vector(all.deg),
   Slice = rep(sl.lab,each=75),
   Status = rep(V(g.week)$Status, times=8))
library(ggplot2)
p = qplot(factor(Degree), data=deg.df,
           geom="bar",fill=Status)
p+facet_grid(Slice~.) + xlab("Degree") + ylab("Count")

# CHUNK 28
top.deg <- lapply(1:8,function(i) {
   all.deg[,i][rank(all.deg[,i])>=70]
 })
table(unlist(lapply(1:8,function(i) 
   as.numeric(names(top.deg[[i]])))))
```



```{r}
V(g.week)$Status[c(7,15)]
```



```{r}
all.str <- sapply(g.sl12,graph.strength)
all.r <- all.str/all.deg
round(all.r[c(7,15),],digits=2)
```



```{r}
summary(c(all.r))
```




```{r}
sp.len <- lapply(1:8, function(i) {
   spl <- shortest.paths(g.sl12[[i]],v=c(7,15),
                         to=V(g.sl12[[i]]),
                         weights=NA)
   spl[spl==Inf] <- NA
   spl
 })
ave.spl <- sapply(1:8,function(i) 
                   apply(sp.len[[i]],1,mean,na.rm=T))
round(ave.spl,digits=2)
```


```{r}
sapply(g.sl12,diameter)
```


```{r}
round(sapply(g.sl12,average.path.length),digits=2)
```



